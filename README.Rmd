---
title: "Prediction of Solar Panel production using Weather data."
author: "Natasha Beaney Colverd"
output:
  word_document: default
  pdf_document: default
---

# PROJECT TITLE

## NON-TECHNICAL EXPLANATION OF YOUR PROJECT

This project's objective is to create a model that predicts the amount of usable power generated by solar panels.

## Data

Two datasets are used in this project:

-   The solar generation data was collected in groups of 1min, 10 mins and 1hour over 24hrs for 12 months during 2013-14. This dataset covered 10 locations. In this project I have used the observations logged every hour.

    In the PV tool document the dataset cleaning process has been done previously by the data collection team. The P_Gen Generator Real Power (kW) is the output variable chosen to be the prediction value.

-   The weather dataset covers every 30 mins 24hours a day for the same 2013-2014 period. This dataset covered 5 substation locations. In the data joining process, only rows with complete matching substation, Date and Time (by the 24h) clock are used in the dataset.

## Composition

-   Both datasets are made up of integer and date and categorical data.

Customer Endpoint Solar Power Generation Data - 2 variables Real Power Generation (kW) - Integer location Date time ID field.

The Weather Data set contains 33 variables This is broken down to: - 1 Location Date Time ID variable that is a combined variable of 3 separate columns in the raw datasets. - 2 Categorical Variables - Showing a direction, both variables are the same with 11 direction options. These two variables have been converted to radians. - All other variables are numbers that have been converted to python integer type for computational ease. - There is no confidential data in this dataset, only publicly available data.

## Pre processing/cleaning/labelling

## Weather dataset pre-processing/cleaning/labelling

```{python eval = FALSE}
weather_data_clean = weather_data[weather_data['Site'].isin(['YMCA', 'Maple Drive East', 'Forest Road'])]
weather_data_clean['Date'] = pd.to_datetime(weather_data_clean['Date'],format='%d/%m/%Y' )
weather_data_clean['Time'] = pd.to_datetime(weather_data_clean['Time'])
weather_data_clean['Time'] = weather_data_clean['Time'].dt.time
weather_data_clean['Datetime'] = pd.to_datetime(weather_data_clean['Date'].astype(str) + ' '+ weather_data_clean['Time'].astype(str))
weather_data_clean['Site Date Time ID'] = weather_data_clean['Datetime'].astype(str) + weather_data_clean['Site']

func_dir(weather_data_clean['WindDir'])
func_dir(weather_data_clean['HiDir'])
weather_data_clean = weather_data_clean.drop(['HiTemp', 'LowTemp'],axis=1)


```

-   Filter out the substations that are not in both datasets.

-   Convert the date column into the same format.

-   Convert the time column to the 24hour clock.

-   Converting substation name, date and time field into a unique ID to be used in the merge between the power dataset and weather dataset.

-   Remove the 'HiTemp' and 'LowTemp' as these data points are represented in the column 'TempOut'.

```{python, eval=FALSE}
def func_dir(d):
    for i in range(17):
        a = ['WNW', 'NW', 'W', 'N', 'WSW', 'NNW', 'NNE', 'SW', 'SSW', 'NE',
       '---', 'ENE', 'SSE', 'S', 'E', 'SE', 'ESE']
        b = [5.11,5.505,4.714,4.324,0.000,	0.390,	5.895,0,3.933, 0.790, 2.752,	3.543,	3.143,2.362, 1.571, 1.181,	1.961]
        d.mask(d == a[i],b[i], inplace=True)
        i = i+1
  
```

The function above shows the process to replace the two direction based categorical variables with radian values.

## Customer Endpoint Dataset pre-processing/cleaning/labelling

-   The P_Gen Generator Real Power (kW) is the output variable chosen to be the prediction value. This value should only be positive, but there was a set of 7,000 that had negative values. Figure 1 shows a box plot of the error values. The errors have been cleaned by replacing the error value with 0.

![Figure 1: Error values in output variable](P_gen_error_boxplot.png){width="382"}

-   Converting substation name, date and time field into a unique ID to be used in the merge between the power dataset and weather dataset.

```{python, eval = FALSE}
customer_end_data_clean['Site Date Time ID'] = customer_end_data_clean['datetime'].astype(str) + customer_end_data_clean['Substation']

```

-   Both datasets are publicly available datasets and each have had cleaning done previously during their creation.

## EDA

![Figure 2: Correlation Map of input to output variables](Correlation%20map.png)

Figure 2 shows the correlation map of the variables with 6 possible outputs. The evidence from this map confirmed the need to remove the 2 additional temperature variables, as ithey represent the same data.

In this model I am treating each instance as an independent variable. So each instance is not connected to the previous value. When splitting the datasets the measures are treated as independent data-points, therefore they have been randomly placed in to the 3 datasets. Another approach to explore in a follow-up project would be to test time-based models and how a time series element could effect the model. If you have any recommendations for models I would love to hear about them.

## PCA

The first step is to use Principal Component Analysis (PCA) to reduce the number of variables as a K-Nearest Neighbour Model is vulnerable to datasets with high dimensionality.

Input: 30 weather variables with standard scaling applied.

Output: 11 PCA variables

Model Architecture: A linear Kernal PCA with 11 components.

### Performance

Of the 4 KNN models tested, the Linear PCA had the lowest reconstruction error of 0.045630.

Using PCA has reduced the number of components from 30 to 11, while maintaining 95% of the data variance. Figure 3 shows the correlation matrix of the new PCA variables, giving evidence to the orthogonality of the data.

![Figure 3: PCA Correlation Map](pca_correlation%20Matrix%20heatmap.png){width="557"}

## KKN

Input: 11 PCA Modeled weather variables

Output: Generator Real power (kW)

Model Architecture: Using the elbow method K =15

![Figure 4: KNN Elbow Curve](KNN%20Elbow%20curve.png){width="578"}

### Performance

Across all models created in this project, the Root Mean Squared Error (RMSE) is the main performance indicator used to compare the performance of each regression model. It measures the average difference between values predicted by a model and the actual values.

The RMSE value of the KNN model is 0.409804.

Figure 5 shows the predicted values of data-points on the x-axis and the error difference between the predictions and the real value on the y-axis.

![Figure 5: KNN Residual Errors](KNN_residual_errors.png)

### Limitations

The KNN model needs the use of PCA due to its sensitivity to high dimensional data, but PCA removes the possibility of manual interpretation of how the data affects the power generation of Solar Panels.

## Linear Regression

During the EDA the dataset showed a strong linear trend, therefore is suitable for a linear model to be fitted. A linear model will use less computational power than other models, so if the accuracy is comparable, then it would be the better model to use. This model also gives us a benchmark performance comparison value to compare with other models.

Input: 11 PCA Modelled weather variables

Output: Generator Real power (kW)

Model Architecture: Default value model

### Performance

The RMSE value of the Linear Regression model is 0.4233267.

Figure 6 shows the predicted values of data points on the x-axis and the error difference between the predictions and the real value on the y-axis (Residual Error).

### Limitations/Trade-Offs

The linear regression model predicted negative values as shown on the x-axis of Figure 2. The Real Power Generation value cannot be negative. This could have been solved with a rule that made any negative value predicted to be replaced by 0. But this, combined with the highest initial RMSE value out of the models fitted on the data, supported the decision not to do any further optimisation of this model.

![Figrue 6: Linear Model Residual Errors](LinearMod_Residual%20Errors.png)

### Random Forest Decision Tree Model

Input: 30 Weather Variables

Output: Generator Real power (kW)

Model Architecture: Random Forest Model bootstrap = 'False', Max_depth = 20, max_features = 'Sqrt' and n_estimators = 300.

This Random Forest model has been optimized by using the grid method. The computational cost of fitting the model is small enough, so using the grid method is an option and produces better results compared to using the Bayesian method.

An EDA of an XBoost decision tree model was conducted on the data. The Rndom Forest model showed better accuracy in comparison so optimization of the Random Forest model was done.

### Performance

The RMSE value of the Random Forest model on the validation data is 0.352396.

The Random Forest model has the best RMSE value of all the models.

Figure 7 shows the predicted values of data points on the x-axis and the error difference between the predictions and the real value on the y-axis. When comparing this to the previous residual error plots, this data has not been scaled.

![Figure 7: Random Forest Residual Errors](RandomForest%20Residual%20error.png)

## ![Figure 8: Feature Importance](Rf_feature_importance.png)

## Contact Details/ Links

<https://www.kaggle.com/datasets/pythonafroz/solar-panel-energy-generation-data>

<https://github.com/nbcolverd/ML-AI-IM-Q4-Solar-Power/tree/main>

<https://www.linkedin.com/in/natasha-beaney-colverd/>
